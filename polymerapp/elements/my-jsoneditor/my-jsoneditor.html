<link rel="import" href="../../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../../bower_components/x-json/src/x-json.html">
<link rel="import" href="../../../bower_components/mat-raised-button/mat-raised-button.html">
<link rel="import" href="./my-jsoneditor-item.html">

<dom-module id="my-jsoneditor">

    <style>

    </style>
    <template>
        <paper-material>
            <h1 class="paper-font-display1"><span>{{jsonEditorData.schema.title}}</span></h1>
            <template is="dom-repeat" items="{{_toArray(jsonEditorData.schema.properties)}}">
                <my-jsoneditor-item item={{item}}></my-jsoneditor-item>
            </template>

            <div id="editor_holder"></div>
        </paper-material>
        <mat-raised-button label="Click me!" on-click="handleClick"></mat-raised-button>
        <paper-material elevation="1">
            <x-json id="myjson" data={{jsonEditorData.value.schema.properties}}></x-json>
        </paper-material>
    </template>
    <script src="../../../bower_components/json-editor/dist/jsoneditor.js"></script>
    <script>
        (function () {
            Polymer({
                is: 'my-jsoneditor',
                properties: {
                    jsonEditorData: {
                        type: Object,
                        observer: '_jsonEditorDataChanged',
                        value: {
                            schema: {

                                type: "object",
                                title: "Plant",
                                properties: {
                                    Name: {
                                        type: "string",
                                        value: ""
                                    },
                                    ImageUrl: {
                                        type: "string",
                                        value: ""
                                    },
                                    Enabled: {
                                        type: "boolean",
                                        value: true
                                    }
                                }
                            }
                        }
                    }

                },
                observers: ['_valueChanged(jsonEditorData.*)'],
                _valueChanged: function (changeRecord) {
                    console.log('changed: ' + changeRecord.path);
                },
                handleClick: function () {
                    this.$.myjson.data = this.jsonEditorData.schema.properties;
                },
                _isSame: function (a, b) {
                    return a === b
                },
                _toArray: function (obj) {
                    return Object.keys(obj).map(function (key) {
                        return {
                            name: key,
                            value: obj[key]
                        };
                    });
                },
                _jsonEditorDataChanged: function (newValue, oldValue) {
                    if (newValue !== null) {
                        this.$.myjson.data = newValue;
                    }
                },
                ready: function () {
                    //  this.$.myjson.data = this.jsonEditorData;

                    this._editor = new JSONEditor(this.$.editor_holder, this.jsonEditorData);
                    console.log("my-jsoneditor ready");
                }
            });
        })();
    </script>

</dom-module>
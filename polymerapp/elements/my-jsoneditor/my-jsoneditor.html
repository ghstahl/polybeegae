<link rel="import" href="../../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../../bower_components/x-json/src/x-json.html">
<link rel="import" href="../../../bower_components/mat-raised-button/mat-raised-button.html">
<link rel="import" href="./my-jsoneditor-item.html">

<dom-module id="my-jsoneditor">

    <style>

    </style>
    <template>
        <paper-material>
            <h1 class="paper-font-display1"><span>{{jsonEditorData.schema.title}}</span></h1>
            <template is="dom-repeat" items="{{_toArray(jsonEditorData.schema.properties)}}">
                <my-jsoneditor-item item={{item}}></my-jsoneditor-item>
            </template>
            <mat-raised-button label="Click me!" on-click="handleClick"></mat-raised-button>
        </paper-material>

        <paper-material elevation="1">
            <x-json id="myjson" data={{jsonEditorData.value.schema.properties}}></x-json>
        </paper-material>
    </template>
    <script>
        (function () {
            Polymer({
                is: 'my-jsoneditor',
                properties: {
                    _arrayData: {
                        type: Array,
                        observer: '_jsonEditorDataChanged',
                    },
                    jsonEditorData: {
                        type: Object,
                        value: {
                            schema: {

                                type: "object",
                                title: "Plant",
                                properties: {
                                    Name: {
                                        type: "string",
                                        value: ""
                                    },
                                    ImageUrl: {
                                        type: "string",
                                        value: ""
                                    },
                                    Enabled: {
                                        type: "boolean",
                                        value: true
                                    }
                                }
                            }
                        }
                    }

                },
                observers: ['_valueChanged(_arrayData.*)'],
                _valueChanged: function (changeRecord) {
                    console.log('_arrayData changed: ' + changeRecord.path);
                },
                handleClick: function () {
                    this.$.myjson.data = this._arrayData;
                },

                _toArray: function (obj) {
                    var thisElement = this;
                    this._arrayData = Object.keys(obj).map(function (key) {
                        return {
                            name: key,
                            value: obj[key]
                        };
                    });
                    return this._arrayData;
                },

                _jsonEditorDataChanged: function (newValue, oldValue) {
                    console.log('_jsonEditorDataChanged changed: ' + newValue);
                },
                ready: function () {
                    console.log("my-jsoneditor ready");
                }
            });
        })();
    </script>

</dom-module>
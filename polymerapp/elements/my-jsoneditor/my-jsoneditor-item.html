<link rel="import" href="../../../bower_components/paper-toggle-button/paper-toggle-button.html">

<dom-module id="my-jsoneditor-item">

    <style is="custom-style">
        .line {
            margin-bottom: 40px;
        }
        
        .line span {
            margin-left: 24px;
        }
    </style>
    <template>

        <template is="dom-if" if="{{_isSame(item.value.type,'string')}} ">
            <paper-input label={{item.name}} value={{item.value.value}} allowed-pattern={{computeAllowedPattern(item.value)}}></paper-input>
        </template>

        <template is="dom-if" if="{{_isSame(item.value.type,'boolean')}} ">
            <div class="line">
                <paper-toggle-button checked={{item.value.value}}></paper-toggle-button>
                <span>{{item.name}}</span>
                <span>{{computeBooleanToString(item.value.value)}}</span>
            </div>
        </template>


    </template>
    <script>
        (function () {
            Polymer({
                is: 'my-jsoneditor-item',

                // Properties
                /////////////////////////////////////////////////////////
                properties: {
                    item: {
                        type: Object,
                        notify: true,
                        observer: '_newItemObserved',
                    },

                    // Read-Only Properties
                    /////////////////////////////////////////////////////////
                    _item_immutable: {
                        type: Object,
                        readOnly: true
                    },
                    paperElementTemplates: {
                        type: Object,
                        notify: true

                    },
                    _item_dirty: {
                        type: Boolean,
                        readOnly: true,
                        value: false
                    },
                    readonly: {
                        type: Boolean,
                        value: true
                    }
                },
                // Methods
                /////////////////////////////////////////////////////////
                _newItemObserved: function (newValue, oldValue) {
                    if (oldValue === undefined) {
                        // move out of item to working set.
                        this._set_item_immutable(JSON.parse(JSON.stringify(newValue)));
                        this._set_item_dirty(false);
                    }
                },
                reset: function () {
                    this.item = this._item_immutable;
                },
                // Observers
                /////////////////////////////////////////////////////////
                observers: ['_valueChanged(item.*)'],
                // Smart check. only fire if we change state.
                _valueChanged: function (changeRecord) {
                    var thisElement = this;
                    if (thisElement._isDirtyValidation() && this._item_dirty === false) {
                        this._set_item_dirty(true);
                        this.fire('item-dirty', {
                            dirty: thisElement._item_dirty,
                            source: thisElement
                        });
                    } else if (!thisElement._isDirtyValidation() && this._item_dirty === true) {
                        this._set_item_dirty(false);
                        this.fire('item-dirty', {
                            dirty: thisElement._item_dirty,
                            source: thisElement
                        });
                    }
                },
                // Utility Methods
                /////////////////////////////////////////////////////////
                _isDirtyValidation: function () {
                    var dirty = this._item_immutable.value.value !== this.item.value.value;
                    return dirty;
                },
                _isSame: function (a, b) {
                    return a === b
                },
                computeBooleanToString: function (a) {
                    return a === true ? 'true' : 'false';
                },
                computeAllowedPattern: function (a) {
                    var allowed = this.paperElementTemplates.paperInput[a.template].allowedPattern
                    return allowed;
                },
                ready: function () {
                    console.log("my-jsoneditor-item ready");
                }
            });
        })();
    </script>

</dom-module>